name: Pro-Dylib-Builder-2026
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-14 # استخدام نظام macOS حديث وسريع (M1/M2)
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Theos (The Pro Way)
        uses: theos/setup-theos@master

      - name: Fetch iOS SDK (Reliable Link)
        run: |
          # تحميل الـ SDK من مستودع موثوق وسريع جداً لتجنب خطأ الـ 289KB
          mkdir -p $THEOS/sdks
          curl -L "https://github.com/theos/sdks/raw/master/iPhoneOS16.5.sdk.tar.xz" -o $THEOS/sdks/iPhoneOS16.5.sdk.tar.xz
          tar -xf $THEOS/sdks/iPhoneOS16.5.sdk.tar.xz -C $THEOS/sdks/
          rm $THEOS/sdks/iPhoneOS16.5.sdk.tar.xz

      - name: Build Tweak (Final Package)
        run: |
          # البناء بنمط الـ Release النهائي لضمان عدم وجود كراش
          make package FINALPACKAGE=1
          
      - name: Upload Dylib
        uses: actions/upload-artifact@v4
        with:
          name: Pro-AntiCrash-Dylib
          path: .theos/obj/*.dylib
